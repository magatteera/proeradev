@model IEnumerable<proera.reclamation>

@{
    ViewBag.Title = "Index";
}

<h2>Liste Reclamations</h2>


<p>
    @Html.ActionLink("Create New", "Create")
</p>

<br />
<br />
@using (Html.BeginForm("changementVillage", "reclamations1", FormMethod.Post))
{
    @Html.AntiForgeryToken()
<div class="form-horizontal">
    <div class="form-row">
        <div class="col">
            <div class="form-group">
                @Html.Label("Region", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownList("region", null, htmlAttributes: new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                @Html.Label("Departement", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    <select class="form-control" name="departement" id="departement">
                        <option value="">Selectionnez le Departement</option>
                    </select>
                </div>
            </div>
        </div>
    </div>


    <div class="form-row">
        <div class="col">
            <div class="form-group">
                @Html.Label("Commune", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    <select class="form-control" name="commune" id="commune">
                        <option value="">Selectionnez le Commune</option>
                    </select>
                </div>
            </div>
        </div>


        <div class="col">
            <div class="form-group">
                @Html.Label("village", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    <select class="form-control" name="localite" id="localite">
                        <option value="">Selectionnez le Village</option>
                    </select>
                </div>
            </div>
        </div>


    </div>
    <button type="submit" class="btn btn-sm btn-success" id="btnchangevillage">Filtrer</button>
</div>

}


    <br />
    <table class="table" id="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.id)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.date)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.priorite)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.commentaire)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.nivintervention)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.telephone)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.localite)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.statut)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.utilisateur)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.clients.Nom1)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.typereclamation.type)
                </th>

                <th>
                    @Html.DisplayNameFor(model => model.refclient)
                </th>


                <th>
                    @Html.DisplayNameFor(model => model.numcompteur)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.datecloture)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.date)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.priorite)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.commentaire)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.nivintervention)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.telephone)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.localite)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.statut)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.utilisateur)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.clients.Nom1)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.typereclamation.type)
                </td>

                <td>
                    @Html.DisplayFor(modelItem => item.refclient)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.numcompteur)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.datecloture)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.id }) |
                    @Html.ActionLink("Details", "Details", new { id = item.id })
                </td>
            </tr>
            }
        </tbody>

    </table>



    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {

            function daysdifference(firstDate, secondDate) {
                var startDay = new Date(firstDate);
                var endDay = new Date(secondDate);

                // Determine the time difference between two dates     
                var millisBetween = startDay.getTime() - endDay.getTime();

                // Determine the number of days between two dates  
                var days = millisBetween / (1000 * 3600 * 24);

                // Show the final number of days between dates     
                return Math.round(Math.abs(days));
            } 

            @*$("#region").prepend("<option seleted>Selectionnez la region</option>")*@

            $('#table > tbody  > tr').each(function (index, tr) {
                @*console.log(index);

                console.log(tr);*@

                var currentRow = $(this);
                console.log(currentRow.find("td:eq(1)").text())
                var date = new Date("DD-MM-YYYY")
                @*date.format("DD-MM-YYYY")*@
                @*console.log(daysdifference(date, currentRow))*@
                console.log(date)
            });

            $("#region").prepend("<option value='0' selected='true'>Selectionnez la region</option>")

            $('#table').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/French.json"
                }
            });

            $("#region").change(function () {

                data = {
                    id: $("#region").val()
                }
                $.ajax({
                    type: "POST",
                    url: "/reclamations1/changementregion",
                    data: data,
                    success: function (data) {
                        $("#departement").empty().
                            append(data.departement)
                        $("#commune").empty().
                            append(data.commune)
                        $("#localite").empty().
                            append(data.village)
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })


            $("#departement").change(function () {
                data = {
                    code_departement: $("#departement").val()
                }
                $.ajax({
                    type: "POST",
                    url: "/reclamations1/changementdepartement",
                    data: data,
                    success: function (data) {
                        $("#commune").empty().
                            append(data.commune)
                        $("#localite").empty().
                            append(data.village)
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })


            $("#commune").change(function () {
                data = {
                    code_com: $("#commune").val()
                }
                $.ajax({
                    type: "POST",
                    url: "/reclamations1/changementcommune",
                    data: data,
                    success: function (data) {
                        $("#localite").empty().
                            append(data.village)
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })



            $("#village").change(function () {
                $("#btnchangevillage").click()
            })
        });
    </script>
